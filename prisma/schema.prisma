// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  email         String   @unique
  password      String
  firstName     String
  lastName      String
  phone         String?
  role          UserRole @default(CLIENT)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  bookings      Booking[]
  favorites     Favorite[]
  reviews       Review[]
}

model Product {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  description   String
  category      Category
  occasion      Occasion[]
  size          String[]
  color         String[]
  brand         String?
  condition     Condition @default(EXCELLENT)
  images        String[]
  
  // Prix
  rentalPrice3Days   Float  // Prix location 3 jours
  rentalPrice4Days   Float  // Prix location 4 jours
  rentalPrice7Days   Float  // Prix location 7 jours
  deposit            Float  // Caution
  
  // Stock et disponibilité
  available     Boolean  @default(true)
  quantity      Int      @default(1)
  
  // Métadonnées
  featured      Boolean  @default(false)
  views         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  bookings      Booking[]
  favorites     Favorite[]
  reviews       Review[]
}

model Booking {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  productId     String   @db.ObjectId
  
  // Dates
  startDate     DateTime
  endDate       DateTime
  returnDate    DateTime?
  
  // Prix et paiement
  rentalDays    Int
  totalPrice    Float
  deposit       Float
  paymentMethod PaymentMethod
  paymentStatus PaymentStatus @default(PENDING)
  
  // Statut
  status        BookingStatus @default(PENDING)
  
  // Notes
  notes         String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id])
  product       Product  @relation(fields: [productId], references: [id])
  
  @@index([userId])
  @@index([productId])
  @@index([startDate, endDate])
}

model Favorite {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  productId     String   @db.ObjectId
  createdAt     DateTime @default(now())
  
  user          User     @relation(fields: [userId], references: [id])
  product       Product  @relation(fields: [productId], references: [id])
  
  @@unique([userId, productId])
}

model Review {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  productId     String   @db.ObjectId
  rating        Int      // 1-5
  comment       String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id])
  product       Product  @relation(fields: [productId], references: [id])
  
  @@index([productId])
}

enum UserRole {
  CLIENT
  ADMIN
  SUPER_ADMIN
}

enum Category {
  BOUBOUS
  ROBES_SOIREE
  ENSEMBLES
  ACCESSOIRES
  CHAUSSURES
  BIJOUX
  ROBES_LONGUES
  ROBES_COURTES_MIDI
  COMBINAISONS
}

enum Occasion {
  MARIAGE
  BAPTEME
  CEREMONIE
  GALA
  SOIREE
  TABASKI
  KORITE
  WEEKEND
}

enum Condition {
  EXCELLENT
  TRES_BON
  BON
}

enum PaymentMethod {
  WAVE
  ORANGE_MONEY
  FREE_MONEY
  CARTE_BANCAIRE
  ESPECES
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
  REFUNDED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_USE
  RETURNED
  CANCELLED
  LATE
}
